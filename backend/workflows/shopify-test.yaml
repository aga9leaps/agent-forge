name: shopify-api-test
description: Test HTTP node with Shopify API
version: 1.0

inputs:
  shop_domain:
    type: string
    required: true
    description: Your Shopify shop domain (e.g., your-store.myshopify.com)
  access_token:
    type: string
    required: true
    description: Shopify Admin API access token

steps:
  - id: get_shop_info
    name: Get Shop Information
    type: http
    config:
      method: GET
      url: "https://{{inputs.shop_domain}}/admin/api/2024-01/shop.json"
      headers:
        X-Shopify-Access-Token: "{{inputs.access_token}}"
        Content-Type: "application/json"
      
  - id: get_products
    name: Get Products List
    type: http
    config:
      method: GET
      url: "https://{{inputs.shop_domain}}/admin/api/2024-01/products.json"
      headers:
        X-Shopify-Access-Token: "{{inputs.access_token}}"
      params:
        limit: 10
        fields: "id,title,vendor,product_type,variants"
        
  - id: format_response
    name: Format Shop Data
    type: transform
    config:
      expression: |
        return {
          shop: {
            name: {{steps.get_shop_info.output.data.shop.name}},
            email: {{steps.get_shop_info.output.data.shop.email}},
            currency: {{steps.get_shop_info.output.data.shop.currency}}
          },
          products_count: {{steps.get_products.output.data.products.length}},
          products: {{steps.get_products.output.data.products}}
        };

outputs:
  shop_name: "{{steps.format_response.output.shop.name}}"
  products: "{{steps.format_response.output.products}}"
  total_products: "{{steps.format_response.output.products_count}}"